.PHONY: all clean test deps 4.1 4.2 4.3 4.4 4.5 4.6 summary

# Chapter 4: Distributed Systems Protocols
# Master Makefile to run all subchapter tests sequentially

all: deps 4.1 4.2 4.3 4.4 4.5 4.6 summary

deps:
	@echo "ğŸ” Checking Chapter 4 dependencies..."
	@echo "   Required: TCP (1.3), UDP (1.4)"
	@if [ ! -f "../01-core-internet-networking/1.3-tcp/tcp_client_server.py" ]; then \
		echo "âŒ Missing dependency: TCP (1.3) - run 'make' in 01-core-internet-networking/1.3-tcp first"; \
		exit 1; \
	fi
	@if [ ! -f "../01-core-internet-networking/1.4-udp/udp_client_server.py" ]; then \
		echo "âŒ Missing dependency: UDP (1.4) - run 'make' in 01-core-internet-networking/1.4-udp first"; \
		exit 1; \
	fi
	@echo "âœ… All Chapter 4 dependencies satisfied"

4.1:
	@echo ""
	@echo "=== 4.1 Raft & Paxos Consensus Protocols ==="
	@cd 4.1-raft-paxos && $(MAKE) all
	@echo "âœ… 4.1 Raft & Paxos completed successfully"

4.2:
	@echo ""
	@echo "=== 4.2 Gossip Protocols ==="
	@cd 4.2-gossip && $(MAKE) all
	@echo "âœ… 4.2 Gossip completed successfully"

4.3:
	@echo ""
	@echo "=== 4.3 AMQP (Advanced Message Queuing Protocol) ==="
	@cd 4.3-amqp && $(MAKE) all
	@echo "âœ… 4.3 AMQP completed successfully"

4.4:
	@echo ""
	@echo "=== 4.4 MQTT (Message Queuing Telemetry Transport) ==="
	@cd 4.4-mqtt && $(MAKE) all
	@echo "âœ… 4.4 MQTT completed successfully"

4.5:
	@echo ""
	@echo "=== 4.5 STOMP (Simple Text Oriented Messaging Protocol) ==="
	@cd 4.5-stomp && $(MAKE) all
	@echo "âœ… 4.5 STOMP completed successfully"

4.6:
	@echo ""
	@echo "=== 4.6 Kafka (Apache Kafka) ==="
	@cd 4.6-kafka && $(MAKE) all
	@echo "âœ… 4.6 Kafka completed successfully"

test:
	@echo ""
	@echo "ğŸ§ª Running Chapter 4 comprehensive tests..."
	@cd 4.1-raft-paxos && $(MAKE) test
	@cd 4.2-gossip && $(MAKE) test
	@cd 4.3-amqp && $(MAKE) test
	@cd 4.4-mqtt && $(MAKE) test
	@cd 4.5-stomp && $(MAKE) test
	@cd 4.6-kafka && $(MAKE) test
	@echo "ğŸ¯ All Chapter 4 tests passed!"

clean:
	@echo "ğŸ§¹ Cleaning Chapter 4 generated files..."
	@cd 4.1-raft-paxos && $(MAKE) clean
	@cd 4.2-gossip && $(MAKE) clean
	@cd 4.3-amqp && $(MAKE) clean
	@cd 4.4-mqtt && $(MAKE) clean
	@cd 4.5-stomp && $(MAKE) clean
	@cd 4.6-kafka && $(MAKE) clean
	@echo "âœ… Chapter 4 cleanup completed"

summary:
	@echo ""
	@echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
	@echo "â•‘                    CHAPTER 4 SUMMARY                        â•‘"
	@echo "â•‘              Distributed Systems Protocols                  â•‘"
	@echo "â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£"
	@echo "â•‘                                                              â•‘"
	@echo "â•‘ ğŸ¯ CONSENSUS PROTOCOLS                                       â•‘"
	@echo "â•‘   4.1 Raft & Paxos: Leader election, log replication        â•‘"
	@echo "â•‘                                                              â•‘"
	@echo "â•‘ ğŸ—£ï¸  GOSSIP PROTOCOLS                                         â•‘"
	@echo "â•‘   4.2 Gossip: Epidemic information spread, failure detection â•‘"
	@echo "â•‘                                                              â•‘"
	@echo "â•‘ ğŸ“¨ MESSAGING PROTOCOLS                                       â•‘"
	@echo "â•‘   4.3 AMQP: Enterprise messaging, exchanges, routing        â•‘"
	@echo "â•‘   4.4 MQTT: IoT messaging, QoS levels, retained messages    â•‘"
	@echo "â•‘   4.5 STOMP: Simple text messaging, WebSocket compatible    â•‘"
	@echo "â•‘                                                              â•‘"
	@echo "â•‘ ğŸŒŠ STREAMING PLATFORMS                                       â•‘"
	@echo "â•‘   4.6 Kafka: Distributed streaming, partitions, replication â•‘"
	@echo "â•‘                                                              â•‘"
	@echo "â•‘ ğŸ”§ KEY CONCEPTS COVERED                                      â•‘"
	@echo "â•‘   â€¢ Distributed consensus and leader election               â•‘"
	@echo "â•‘   â€¢ Fault-tolerant communication patterns                   â•‘"
	@echo "â•‘   â€¢ Message queuing and publish-subscribe                   â•‘"
	@echo "â•‘   â€¢ Real-time data streaming and processing                 â•‘"
	@echo "â•‘   â€¢ Horizontal scaling and partitioning                     â•‘"
	@echo "â•‘   â€¢ Exactly-once delivery semantics                         â•‘"
	@echo "â•‘                                                              â•‘"
	@echo "â•‘ ğŸ“Š IMPLEMENTATION HIGHLIGHTS                                 â•‘"
	@echo "â•‘   â€¢ 6 complete protocol implementations                     â•‘"
	@echo "â•‘   â€¢ 18 Python simulation files                              â•‘"
	@echo "â•‘   â€¢ 6 Mermaid architecture diagrams                         â•‘"
	@echo "â•‘   â€¢ 18 matplotlib visual diagrams                           â•‘"
	@echo "â•‘   â€¢ Comprehensive test suites                               â•‘"
	@echo "â•‘   â€¢ Real-world engineering scenarios                        â•‘"
	@echo "â•‘                                                              â•‘"
	@echo "â•‘ ğŸŒ REAL-WORLD APPLICATIONS                                   â•‘"
	@echo "â•‘   â€¢ Microservices coordination (Raft/Paxos)                 â•‘"
	@echo "â•‘   â€¢ Distributed system monitoring (Gossip)                  â•‘"
	@echo "â•‘   â€¢ Enterprise integration (AMQP)                           â•‘"
	@echo "â•‘   â€¢ IoT device communication (MQTT)                         â•‘"
	@echo "â•‘   â€¢ Web application messaging (STOMP)                       â•‘"
	@echo "â•‘   â€¢ Real-time data pipelines (Kafka)                        â•‘"
	@echo "â•‘                                                              â•‘"
	@echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
	@echo ""
	@echo "ğŸ‰ Chapter 4: Distributed Systems Protocols completed successfully!"
	@echo "   All protocols tested and validated âœ…"
	@echo "   Ready for production learning scenarios ğŸš€"
	@echo ""
